@model ClientMDA.ViewModels.CMemberCommentViewModel
@using Microsoft.AspNetCore.Http
@using System.Text.Json;
@inject IHttpContextAccessor Accessor
@{
    var a = "";
    會員member mem = null;
    if (Accessor.HttpContext.Session.Keys.Contains(ClientMDA.Models.CDictionary.SK_LOGINED_USER))
    {
        a = Accessor.HttpContext.Session.GetString(ClientMDA.Models.CDictionary.SK_LOGINED_USER);
        mem = JsonSerializer.Deserialize<會員member>(a);
    }

}
@{
    ViewData["Title"] = "會員評論";
}

@section Styles{
    <style>
        #memBgImg { /*會員背景圖*/
            background: #E55D87; /* fallback for old browsers */
            background: -webkit-linear-gradient(to right, #5FC3E4, #E55D87); /* Chrome 10-25, Safari 5.1-6 */
            background: linear-gradient(to right, rgba(137, 211, 235,0.8), rgba(236, 137, 168,0.8)); /* W3C, IE 10+/ Edge, Firefox 16+, Chrome 26+, Opera 12+, Safari 7+ */
        }

        .membtn {
            float: right;
            bottom: 0;
            margin-right: 20px;
        }

        .events-desc { /*時間軸評論內容*/
            overflow: hidden !important; /*溢位*/
            text-overflow: ellipsis !important; /*文字溢位ellipsis... */
            display: -webkit-box;
            -webkit-line-clamp: 3; /*限制元素顯示文字行數*/
            -webkit-box-orient: vertical; /*垂直排列*/
            word-break: break-all;
        }
    </style>
}

<link rel="stylesheet" type="text/css" href="~/css/Comment/jquery.eeyellow.Timeline.css" /> @*我的評論時間軸*@

@*會員header*@
<div id="memBgImg" class="py-1 bg-image-full">
    @*會員背景圖*@
    <div class="text-center my-5">

        @if (@Model.會員照片image != null)
        {
            <img style="width: 100%+733px !important;" class="img-fluid rounded-circle mb-4" width="150" alt="..."
                 src="https://localhost:44381/images/Member/@Model.會員照片image">
        }
        else
        {
            <img style="width: 100%+733px !important;" class="img-fluid rounded-circle mb-4" width="150" alt="..."
                 src="~/images/Member/MEMBER.png">
            @*會員預設大頭貼 https://dummyimage.com/150x150/6c757d/dee2e6.jpg *@
        }
        <h4 class="text-white fs-3 fw-bolder">@Model.暱稱nickName</h4>
        @*<span class="text-white-50 mb-0">@@帳號</span><br />
            <span class="text-white-50 mb-0">此用戶觀看過N部電影</span>*@
        <span class="text-white-50 mb-0">@*@mem.電影評論movieComments.Count*@ @Model.commentCount 則評論 ‧ @Model.memberfollow 人追蹤</span><br />
        <div class="membtn">
            @Html.ActionLink("追蹤會員", "follow會員", new { followMid = 1 }, new { @class = "btn btn-info btn-sm", id = "followMem" })
            @Html.ActionLink("取消追蹤", "unfollow會員", new { followMid = 1 }, new { @class = "btn btn-info btn-sm", id = "followMem" })
            @*<button class="btn btn-info btn-sm" id="follow">追蹤會員</button>*@
            <button type="button" id="btnReport" class="btn btn-danger btn-sm" data-toggle="modal" data-target="#reportModal">檢舉</button>
            @{
                if (mem != null)
                {
                    <!-- Modal -->
                    <div class="modal fade" id="reportModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
                        <div class="modal-dialog modal-dialog-centered" role="document">
                            @using (Html.BeginForm("Report檢舉", "Comment"))
                            {
                                <div class="modal-content">
                                    <div class="modal-header">
                                        <h5 class="modal-title" id="exampleModalLongTitle" style="color:black">檢舉</h5>
                                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                            <span aria-hidden="true">&times;</span>
                                        </button>
                                    </div>
                                    <div class="modal-body" style="color:black">
                                        <!--modal content start-->
                                        <input type="hidden" name="會員編號Member_ID" value="@mem.會員編號memberId" />
                                        <input type="hidden" name="對象Target_ID" value="1" />
                                        <input type="hidden" name="追讚倒編號ActionType_ID" value="3" />
                                        <input type="hidden" name="連接編號Connect_ID" value="1" />
                                        <input type="hidden" name="" value="" />
                                        <div><label>檢舉人</label><input type="text" readonly value="@mem.會員電話cellphone" /></div>
                                        <div><label>檢舉對象</label><input type="text" readonly value="Yuka" /></div>
                                        <div><label>檢舉理由</label><textarea cols="50" name="檢舉理由ReportReason"></textarea></div>
                                        <!--modal content end-->
                                    </div>
                                    <div class="modal-footer">
                                        <button type="button" class="btn btn-secondary" data-dismiss="modal">取消</button>
                                        <button type="submit" class="btn btn-primary" id="submitAddList">確定</button>
                                    </div>
                                </div>
                            }
                        </div>
                    </div>
                    <!--modal end-->
                }
            }
        </div>
    </div>
</div>

@*評論時間軸*@
<body>
    <div class="VivaTimeline">
        <dl>
            <!--今天-->
            <dt>Today</dt>
            <dt>@DateTime.Now.ToString("yyyy") - @DateTime.Now.ToString("MMMM", new System.Globalization.CultureInfo("en-us")).Substring(0, 3)</dt>


            @await Component.InvokeAsync("時間軸評論", new { id = Model.會員編號memberId })


            <!--會員建立日期-->
            <dt>@Model.建立時間createdTime.ToString("yyyy") - @Model.建立時間createdTime.ToString("MMMM", new System.Globalization.CultureInfo("en-us")).Substring(0, 3)</dt>
            <dt>Start</dt>
            <br />
        </dl>
    </div>
</body>

@section Scripts{
    <script>
        $('.VivaTimeline').vivaTimeline();
        $('.VivaTimeline').vivaTimeline({
            carousel: true
        });
        $('.VivaTimeline').vivaTimeline({
            carousel: true,
            carouselTime: 3000
        });

    </script>
    @*<script src="jquery.min.js"></script>
        <script src="bootstrap.min.js"></script>*@
    <script src="~/js/Comment/jquery.eeyellow.Timeline.js"></script> @*我的評論時間軸*@

    <script>
        //const follow = document.querySelector('#followMem')
        //follow.addEventListener('click', () => {
        //})
    </script>
    <script>
            window.onload=function () {
                if ('@a' == "") {
                    document.querySelector("#btnReport").addEventListener('click', () => {
                        @{Accessor.HttpContext.Session.SetString(CDictionary.SK登後要前往的頁面, "~/Comment/會員評論/1");}
                        window.location = '@Url.Content("~/member/login")'
                    })
                }
            }
    </script>

}



